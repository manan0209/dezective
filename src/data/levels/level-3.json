{
  "id": "level-3",
  "title": "Social Engineering Attack",
  "difficulty": "Advanced",
  "description": "An employee fell victim to a sophisticated phishing attack. Analyze the attack vector and trace the attacker's methods.",
  "scenario": {
    "briefing": "Code Red: Our HR manager received what appeared to be a legitimate email from the CEO requesting employee data. The email looked authentic, but something was wrong. The manager provided sensitive information before realizing the deception. You need to analyze the attack and determine how much data was compromised.",
    "objective": "Analyze the phishing attack, identify the attacker's methods, and determine what information was stolen.",
    "timeLimit": 3000,
    "maxHints": 5
  },
  "environment": {
    "serverName": "mail-server-03",
    "osType": "Linux",
    "availableCommands": [
      "ls", "cat", "grep", "find", "head", "tail", "less", "pwd", "cd", "history", "whoami", "ps", "netstat", "last", "awk", "sort", "uniq", "wc", "strings", "file", "xxd"
    ],
    "fileSystem": {
      "/var/mail/hrmanager/inbox/phishing_email.eml": {
        "type": "file",
        "content": [
          "From: ceo@company-mail.org",
          "To: hrmanager@company.com",
          "Subject: URGENT: Employee Data Request - Board Meeting",
          "Date: 2024-01-20 14:30:00",
          "Message-ID: <urgent_request_2024@company-mail.org>",
          "Content-Type: text/html; charset=UTF-8",
          "",
          "<html>",
          "<body>",
          "<p>Dear HR Manager,</p>",
          "<p>I need the complete employee database immediately for the emergency board meeting.",
          "The investors are asking for headcount and salary information.</p>",
          "<p>Please send the following ASAP:</p>",
          "<ul>",
          "<li>Employee names and SSNs</li>",
          "<li>Salary information</li>",
          "<li>Personal contact details</li>",
          "</ul>",
          "<p>This is confidential and time-sensitive.</p>",
          "<p>Best regards,<br>CEO</p>",
          "<p><small>Sent from my iPhone</small></p>",
          "</body>",
          "</html>"
        ]
      },
      "/var/mail/hrmanager/sent/reply_to_ceo.eml": {
        "type": "file",
        "content": [
          "From: hrmanager@company.com",
          "To: ceo@company-mail.org",
          "Subject: RE: URGENT: Employee Data Request - Board Meeting",
          "Date: 2024-01-20 14:45:00",
          "",
          "Dear CEO,",
          "",
          "I've attached the requested employee information as requested.",
          "Please find the complete database export in the attached file.",
          "",
          "Let me know if you need anything else for the meeting.",
          "",
          "Best regards,",
          "HR Manager",
          "",
          "Attachment: employee_database_export.csv (2.4MB)"
        ]
      },
      "/var/log/mail.log": {
        "type": "file",
        "content": [
          "2024-01-20 14:30:15 [INFO] Received email from ceo@company-mail.org",
          "2024-01-20 14:30:16 [WARNING] SPF check failed for domain company-mail.org",
          "2024-01-20 14:30:16 [WARNING] DKIM signature invalid",
          "2024-01-20 14:30:17 [INFO] Email delivered to hrmanager@company.com",
          "2024-01-20 14:45:23 [INFO] Outbound email from hrmanager@company.com",
          "2024-01-20 14:45:25 [INFO] Large attachment detected: 2.4MB",
          "2024-01-20 14:45:28 [INFO] Email with attachment sent to ceo@company-mail.org"
        ]
      },
      "/var/log/dns.log": {
        "type": "file",
        "content": [
          "2024-01-20 14:29:45 DNS lookup: company-mail.org -> 185.199.108.153",
          "2024-01-20 14:29:46 Reverse DNS: 185.199.108.153 -> malicious-server.darkweb.ru",
          "2024-01-20 14:30:00 DNS lookup: company.com -> 192.168.1.10",
          "2024-01-20 14:30:01 Legitimate domain confirmed: company.com"
        ]
      },
      "/etc/postfix/header_checks": {
        "type": "file",
        "content": [
          "# Postfix header checks configuration",
          "/^Received:.*company-mail\\.org/ WARN Suspicious domain detected",
          "/^From:.*company-mail\\.org/ WARN Potential spoofing attempt",
          "# SPF and DKIM checks",
          "/^Authentication-Results:.*spf=fail/ WARN SPF check failed",
          "/^Authentication-Results:.*dkim=fail/ WARN DKIM verification failed"
        ]
      },
      "/home/hrmanager/.bash_history": {
        "type": "file",
        "content": [
          "mysql -u hr_user -p employees_db",
          "SELECT * FROM employees INTO OUTFILE '/tmp/employee_database_export.csv';",
          "ls -la /tmp/",
          "scp /tmp/employee_database_export.csv hrmanager@company.com:~/",
          "mutt -s 'RE: URGENT: Employee Data Request' -a employee_database_export.csv ceo@company-mail.org",
          "rm /tmp/employee_database_export.csv",
          "history | tail -20"
        ]
      },
      "/tmp/investigation_report.txt": {
        "type": "file",
        "content": [
          "PHISHING ATTACK ANALYSIS REPORT",
          "================================",
          "",
          "Attack Vector: Email Spoofing + Social Engineering",
          "Target: HR Manager",
          "Impersonated: Company CEO",
          "",
          "Technical Indicators:",
          "- Spoofed domain: company-mail.org (typosquatting company.com)",
          "- Failed SPF authentication",
          "- Invalid DKIM signature",
          "- Malicious IP: 185.199.108.153 (traced to darkweb.ru)",
          "",
          "Compromised Data:",
          "- Complete employee database (2.4MB)",
          "- Employee names and SSNs",
          "- Salary information",
          "- Personal contact details",
          "",
          "Recommendation: Immediate password reset for all employees,",
          "credit monitoring, and enhanced email security training."
        ]
      },
      "/var/log/whois_company-mail.org.txt": {
        "type": "file",
        "content": [
          "Domain Name: COMPANY-MAIL.ORG",
          "Registry Domain ID: 2745689123_DOMAIN_ORG-VRSN",
          "Registrar: SUSPICIOUS DOMAINS LLC",
          "Creation Date: 2024-01-19T23:45:00Z",
          "Registry Expiry Date: 2024-02-19T23:45:00Z",
          "Registrant Name: John Smith",
          "Registrant Organization: [REDACTED]",
          "Registrant Street: [REDACTED]",
          "Registrant City: Moscow",
          "Registrant Country: RU",
          "Admin Email: admin@protonmail.com",
          "Tech Email: tech@protonmail.com",
          "Name Server: ns1.malicious-hosting.ru",
          "Name Server: ns2.malicious-hosting.ru"
        ]
      }
    }
  },
  "clues": [
    {
      "id": "clue-1",
      "title": "Suspicious Email Headers",
      "description": "The phishing email contains suspicious header information that reveals it's not legitimate.",
      "hint": "Check the email headers and authentication results in the mail logs",
      "triggerCommands": ["cat /var/mail/hrmanager/inbox/phishing_email.eml", "grep -i spf /var/log/mail.log"],
      "revealed": false
    },
    {
      "id": "clue-2",
      "title": "Domain Analysis",
      "description": "The sender's domain is a typosquatting attempt designed to fool the recipient.",
      "hint": "Compare the sender's domain with the legitimate company domain and check DNS logs",
      "triggerCommands": ["grep company-mail.org /var/log/dns.log", "cat /var/log/whois_company-mail.org.txt"],
      "revealed": false
    },
    {
      "id": "clue-3",
      "title": "Data Exfiltration",
      "description": "The HR manager unknowingly sent sensitive employee data to the attacker.",
      "hint": "Check the HR manager's sent emails and command history to see what data was sent",
      "triggerCommands": ["cat /var/mail/hrmanager/sent/reply_to_ceo.eml", "cat /home/hrmanager/.bash_history"],
      "revealed": false
    },
    {
      "id": "clue-4",
      "title": "Mail Server Warnings",
      "description": "The mail server detected several red flags but didn't block the email.",
      "hint": "Look at the mail server configuration and logs for authentication failures",
      "triggerCommands": ["cat /etc/postfix/header_checks", "grep -i warning /var/log/mail.log"],
      "revealed": false
    },
    {
      "id": "clue-5",
      "title": "Attack Origin",
      "description": "The attack originated from a known malicious IP address in a foreign country.",
      "hint": "Trace the IP address of the malicious domain through DNS logs",
      "triggerCommands": ["grep 185.199.108.153 /var/log/dns.log"],
      "revealed": false
    }
  ],
  "solution": {
    "steps": [
      "Analyze the phishing email headers to identify authentication failures",
      "Compare sender domain (company-mail.org) with legitimate domain (company.com)",
      "Check DNS logs to trace the malicious IP address",
      "Review HR manager's actions to determine what data was compromised",
      "Examine mail server warnings that were ignored",
      "Identify the complete scope of the data breach"
    ],
    "finalAnswer": "/tmp/investigation_report.txt",
    "explanation": "The attack used domain spoofing (company-mail.org vs company.com) combined with social engineering to trick the HR manager. Despite mail server warnings about failed SPF/DKIM checks, the email was delivered. The attacker successfully obtained a complete employee database containing sensitive PII."
  },
  "scoring": {
    "maxScore": 2000,
    "timeBonus": 500,
    "hintPenalty": 150,
    "wrongCommandPenalty": 100
  }
}
